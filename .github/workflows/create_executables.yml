name: Build and Release Executables

on:
  workflow_dispatch:
    inputs:
      version:
        description: "Enter the version (e.g., v1.0.0)"
        required: true

permissions:
  contents: write

jobs:
  build:
    strategy:
      matrix:
        include:
          - os: ubuntu-latest
            arch: x64
            platform: linux
          - os: ubuntu-latest
            arch: arm64
            platform: linux
          - os: windows-latest
            arch: x64
            platform: windows
          - os: macos-latest
            arch: x64
            platform: macos
          - os: macos-latest
            arch: arm64
            platform: macos
    runs-on: ${{ matrix.os }}

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v4

      - name: Install dependencies
        run: |
          pip install -r requirements.txt

      - name: Build executable with PyInstaller
        run: |
          pyinstaller --noconfirm --onefile grep-docx.py

      - name: Prepare artifact filename
        run: |
          mkdir -p built
          if [ "${{ matrix.platform }}" = "windows" ]; then
            mv dist/grep-docx.exe built/grep-docx-windows-${{ matrix.arch }}.exe
          elif [ "${{ matrix.platform }}" = "linux" ]; then
            mv dist/grep-docx built/grep-docx-linux-${{ matrix.arch }}
          elif [ "${{ matrix.platform }}" = "macos" ]; then
            mv dist/grep-docx built/grep-docx-macos-${{ matrix.arch }}
          fi
        shell: bash

      - name: Upload build artifact for workflow release step
        uses: actions/upload-artifact@v4
        with:
          name: grep-docx-${{ matrix.os }}
          path: dist/*

